{"ast":null,"code":"import { fetchError, fetchStart, fetchSuccess } from '../../redux/actions';\nimport React from 'react';\nimport axios from '../../util/Api';\nimport { SET_AUTH_USER_DATA, UPDATE_LOAD_USER, USER_TOKEN_SET } from \"../../constants/ActionTypes\";\nimport { Cookies } from 'react-cookie';\nexport const setAuthUser = user => {\n  return dispatch => {\n    dispatch({\n      type: SET_AUTH_USER_DATA,\n      payload: user\n    });\n  };\n};\nexport const updateLoadUser = () => {\n  return dispatch => {\n    dispatch({\n      type: UPDATE_LOAD_USER\n    });\n  };\n};\nexport const setAUthToken = token => {\n  return dispatch => {\n    dispatch({\n      type: USER_TOKEN_SET,\n      payload: token\n    });\n  };\n};\nexport const onRegister = ({\n  name,\n  email,\n  password\n}) => {\n  return dispatch => {\n    dispatch(fetchStart());\n    axios.post('auth/register', {\n      email: email,\n      password: password,\n      name: name\n    }).then(({\n      data\n    }) => {\n      if (data.result) {\n        if (data.token.access_token) {\n          axios.defaults.headers.common['Authorization'] = 'Bearer ' + data.token.access_token;\n          const cookies = new Cookies();\n          cookies.set('token', data.token.access_token);\n        }\n\n        dispatch({\n          type: USER_TOKEN_SET,\n          payload: data.token.access_token\n        });\n        dispatch(fetchSuccess());\n        getAuthUser(dispatch);\n      } else {\n        dispatch(fetchError(\"Some thing went wrong!\"));\n      }\n    }).catch(function (error) {\n      dispatch(fetchError(error.message));\n    });\n  };\n};\nexport const onLogin = ({\n  email,\n  password\n}) => {\n  return dispatch => {\n    try {\n      dispatch(fetchStart());\n      axios.post('auth/login', {\n        email: email,\n        password: password\n      }).then(({\n        data\n      }) => {\n        console.log(\"onLogin: \", data);\n\n        if (data.result) {\n          dispatch(fetchSuccess());\n\n          if (data.token.access_token) {\n            const cookies = new Cookies();\n            cookies.set('token', data.token.access_token);\n            dispatch({\n              type: USER_TOKEN_SET,\n              payload: data.token.access_token\n            });\n            axios.defaults.headers.common['Authorization'] = 'Bearer ' + data.token.access_token;\n            getAuthUser(dispatch);\n          }\n        } else {\n          dispatch(fetchError(data.error));\n        }\n      }).catch(function (error) {\n        dispatch(fetchError(error.message));\n      });\n    } catch (error) {\n      dispatch(fetchError(error.message));\n    }\n  };\n};\nexport const onLogout = route => {\n  console.log(\"onLogout\");\n  return dispatch => {\n    dispatch(fetchStart());\n    axios.post('auth/logout').then(({\n      data\n    }) => {\n      console.log(\"onLogout\", data);\n\n      if (data.result) {\n        route.push(\"/signin\");\n        dispatch({\n          type: USER_TOKEN_SET,\n          payload: null\n        });\n        dispatch(fetchSuccess());\n        const cookies = new Cookies();\n        cookies.remove('token');\n        dispatch(setAuthUser(null));\n      } else {\n        console.log(\"onLogout data.error\", data.error);\n        const cookies = new Cookies();\n        cookies.remove('token');\n        dispatch(setAuthUser(null));\n        dispatch(fetchError(data.error));\n      }\n    }).catch(function (error) {\n      console.log(\"onLogout error\", error);\n      const cookies = new Cookies();\n      cookies.remove('token');\n      dispatch(setAuthUser(null));\n      dispatch(fetchError(error.message));\n    });\n  };\n};\nexport const getAuthUser = dispatch => {\n  dispatch(fetchStart());\n  axios.post('auth/me').then(({\n    data\n  }) => {\n    console.log(\"getAuthUser: \", data.user);\n\n    if (data.result) {\n      dispatch(fetchSuccess());\n      dispatch(setAuthUser(data.user));\n    } else {\n      dispatch(updateLoadUser());\n    }\n  }).catch(function (error) {\n    dispatch(updateLoadUser());\n  });\n};\nexport const getAuthUser0 = (loaded = false, token) => {\n  return dispatch => {\n    if (!token) {\n      const token = getCookie('token');\n      if (token) axios.defaults.headers.common['Authorization'] = 'Bearer ' + token;\n    }\n\n    dispatch(fetchStart());\n    dispatch(updateLoadUser(loaded));\n    axios.post('auth/me').then(({\n      data\n    }) => {\n      if (data.result) {\n        dispatch(fetchSuccess());\n        dispatch(setAuthUser(data.user));\n      } else {\n        dispatch(updateLoadUser(true));\n      }\n    }).catch(function (error) {\n      dispatch(updateLoadUser(true));\n    });\n  };\n};","map":{"version":3,"sources":["C:/Users/hp/Desktop/webD course 2020/internship/avanzar/1. Domain Handler/wieldy-v-2.3.0/next-js-jwt-stater-kit/redux/actions/Auth.js"],"names":["fetchError","fetchStart","fetchSuccess","React","axios","SET_AUTH_USER_DATA","UPDATE_LOAD_USER","USER_TOKEN_SET","Cookies","setAuthUser","user","dispatch","type","payload","updateLoadUser","setAUthToken","token","onRegister","name","email","password","post","then","data","result","access_token","defaults","headers","common","cookies","set","getAuthUser","catch","error","message","onLogin","console","log","onLogout","route","push","remove","getAuthUser0","loaded","getCookie"],"mappings":"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","sourcesContent":["import {fetchError, fetchStart, fetchSuccess} from '../../redux/actions';\r\nimport React from 'react';\r\nimport axios from '../../util/Api';\r\nimport {SET_AUTH_USER_DATA, UPDATE_LOAD_USER, USER_TOKEN_SET} from \"../../constants/ActionTypes\";\r\nimport {Cookies} from 'react-cookie'\r\n\r\nexport const setAuthUser = user => {\r\n  return dispatch => {\r\n    dispatch({\r\n      type: SET_AUTH_USER_DATA,\r\n      payload: user,\r\n    });\r\n  };\r\n};\r\n\r\nexport const updateLoadUser = () => {\r\n  return dispatch => {\r\n    dispatch({\r\n      type: UPDATE_LOAD_USER,\r\n    });\r\n  };\r\n};\r\nexport const setAUthToken = token => {\r\n  return dispatch => {\r\n    dispatch({\r\n      type: USER_TOKEN_SET,\r\n      payload: token,\r\n    });\r\n  };\r\n};\r\n\r\nexport const onRegister = ({name, email, password}) => {\r\n  return dispatch => {\r\n    dispatch(fetchStart());\r\n    axios\r\n      .post('auth/register', {\r\n        email: email,\r\n        password: password,\r\n        name: name,\r\n      })\r\n      .then(({data}) => {\r\n        if (data.result) {\r\n          if (data.token.access_token) {\r\n            axios.defaults.headers.common['Authorization'] = 'Bearer ' + data.token.access_token;\r\n            const cookies = new Cookies();\r\n            cookies.set('token', data.token.access_token);\r\n          }\r\n          dispatch({\r\n            type: USER_TOKEN_SET,\r\n            payload: data.token.access_token\r\n          });\r\n          dispatch(fetchSuccess());\r\n          getAuthUser(dispatch);\r\n        } else {\r\n          dispatch(fetchError(\"Some thing went wrong!\"));\r\n        }\r\n      })\r\n      .catch(function (error) {\r\n        dispatch(fetchError(error.message));\r\n      });\r\n  };\r\n};\r\n\r\nexport const onLogin = ({email, password}) => {\r\n  return dispatch => {\r\n    try {\r\n      dispatch(fetchStart());\r\n      axios\r\n        .post('auth/login', {\r\n          email: email,\r\n          password: password,\r\n        })\r\n        .then(({data}) => {\r\n          console.log(\"onLogin: \", data);\r\n          if (data.result) {\r\n            dispatch(fetchSuccess());\r\n            if (data.token.access_token) {\r\n              const cookies = new Cookies();\r\n              cookies.set('token', data.token.access_token);\r\n              dispatch({\r\n                type: USER_TOKEN_SET,\r\n                payload: data.token.access_token\r\n              });\r\n              axios.defaults.headers.common['Authorization'] = 'Bearer ' + data.token.access_token;\r\n              getAuthUser(dispatch);\r\n            }\r\n          } else {\r\n            dispatch(fetchError(data.error));\r\n          }\r\n        })\r\n        .catch(function (error) {\r\n          dispatch(fetchError(error.message));\r\n        });\r\n    } catch (error) {\r\n      dispatch(fetchError(error.message));\r\n    }\r\n  };\r\n};\r\n\r\n\r\nexport const onLogout = (route) => {\r\n  console.log(\"onLogout\");\r\n  return dispatch => {\r\n    dispatch(fetchStart());\r\n    axios\r\n      .post('auth/logout')\r\n      .then(({data}) => {\r\n        console.log(\"onLogout\", data);\r\n        if (data.result) {\r\n          route.push(\"/signin\");\r\n          dispatch({\r\n            type: USER_TOKEN_SET,\r\n            payload: null\r\n          });\r\n          dispatch(fetchSuccess());\r\n          const cookies = new Cookies();\r\n          cookies.remove('token');\r\n          dispatch(setAuthUser(null));\r\n        } else {\r\n          console.log(\"onLogout data.error\", data.error);\r\n          const cookies = new Cookies();\r\n          cookies.remove('token');\r\n          dispatch(setAuthUser(null));\r\n          dispatch(fetchError(data.error));\r\n        }\r\n      })\r\n      .catch(function (error) {\r\n        console.log(\"onLogout error\", error);\r\n        const cookies = new Cookies();\r\n        cookies.remove('token');\r\n        dispatch(setAuthUser(null));\r\n        dispatch(fetchError(error.message));\r\n      });\r\n  };\r\n};\r\n\r\nexport const getAuthUser = (dispatch) => {\r\n  dispatch(fetchStart());\r\n  axios\r\n    .post('auth/me')\r\n    .then(({data}) => {\r\n      console.log(\"getAuthUser: \", data.user)\r\n      if (data.result) {\r\n        dispatch(fetchSuccess());\r\n        dispatch(setAuthUser(data.user));\r\n      } else {\r\n        dispatch(updateLoadUser());\r\n      }\r\n    })\r\n    .catch(function (error) {\r\n      dispatch(updateLoadUser());\r\n    });\r\n};\r\nexport const getAuthUser0 = (loaded = false, token) => {\r\n  return dispatch => {\r\n    if (!token) {\r\n      const token = getCookie('token');\r\n      if (token)\r\n        axios.defaults.headers.common['Authorization'] = 'Bearer ' + token;\r\n    }\r\n    dispatch(fetchStart());\r\n    dispatch(updateLoadUser(loaded));\r\n    axios\r\n      .post('auth/me')\r\n      .then(({data}) => {\r\n        if (data.result) {\r\n          dispatch(fetchSuccess());\r\n          dispatch(setAuthUser(data.user));\r\n        } else {\r\n          dispatch(updateLoadUser(true));\r\n        }\r\n      })\r\n      .catch(function (error) {\r\n        dispatch(updateLoadUser(true));\r\n      });\r\n  };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}