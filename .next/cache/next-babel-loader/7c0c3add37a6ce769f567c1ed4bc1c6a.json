{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useEffect, useState } from \"react\";\nimport { Cookies } from \"react-cookie\";\nimport { fetchStart, fetchSuccess, setAUthToken } from \"../redux/actions\";\nimport jwtAxios from './Api';\nimport { SET_AUTH_USER_DATA, UPDATE_LOAD_USER } from \"../constants/ActionTypes\";\nexport var useAuthToken = function useAuthToken() {\n  _s();\n\n  var dispatch = useDispatch();\n\n  var _useState = useState(true),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useSelector = useSelector(function (_ref) {\n    var auth = _ref.auth;\n    return auth;\n  }),\n      user = _useSelector.user;\n\n  useEffect(function () {\n    var validateAuth = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var cookies, token, _yield$jwtAxios$post, data;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                dispatch(fetchStart());\n                cookies = new Cookies();\n                token = cookies.get(\"token\");\n                console.log(\"token: =====>\", token);\n\n                if (token) {\n                  _context.next = 7;\n                  break;\n                }\n\n                dispatch(fetchSuccess());\n                return _context.abrupt(\"return\");\n\n              case 7:\n                dispatch(setAUthToken(token));\n                _context.prev = 8;\n                _context.next = 11;\n                return jwtAxios.post(\"auth/me\");\n\n              case 11:\n                _yield$jwtAxios$post = _context.sent;\n                data = _yield$jwtAxios$post.data;\n                console.log(\"data: \", data);\n                dispatch(fetchSuccess());\n                dispatch({\n                  type: SET_AUTH_USER_DATA,\n                  payload: data.user\n                });\n                return _context.abrupt(\"return\");\n\n              case 19:\n                _context.prev = 19;\n                _context.t0 = _context[\"catch\"](8);\n                console.log(\"err in auth: \", _context.t0);\n                dispatch(fetchSuccess());\n                return _context.abrupt(\"return\");\n\n              case 24:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[8, 19]]);\n      }));\n\n      return function validateAuth() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    var checkAuth = function checkAuth() {\n      Promise.all([validateAuth()]).then(function () {\n        setLoading(false);\n        dispatch({\n          type: UPDATE_LOAD_USER\n        });\n      });\n    };\n\n    checkAuth();\n  }, [dispatch]);\n  return [loading, user];\n};\n\n_s(useAuthToken, \"YnKWtr/UKDje7yjY2/5sRAO3lwM=\", false, function () {\n  return [useDispatch, useSelector];\n});\n\nexport var useAuthUser = function useAuthUser() {\n  _s2();\n\n  var _useSelector2 = useSelector(function (_ref3) {\n    var auth = _ref3.auth;\n    return auth;\n  }),\n      user = _useSelector2.user;\n\n  if (user) {\n    return _objectSpread({\n      id: 1\n    }, user);\n  }\n\n  return [null];\n};\n\n_s2(useAuthUser, \"Jxgif+QfY7+MStbF+F1uZ9ypUGY=\", false, function () {\n  return [useSelector];\n});","map":{"version":3,"sources":["C:/Users/hp/Desktop/webD course 2020/internship/avanzar/1. Domain Handler/wieldy-v-2.3.0/next-js-jwt-stater-kit/util/AppHooks.js"],"names":["useDispatch","useSelector","useEffect","useState","Cookies","fetchStart","fetchSuccess","setAUthToken","jwtAxios","SET_AUTH_USER_DATA","UPDATE_LOAD_USER","useAuthToken","dispatch","loading","setLoading","auth","user","validateAuth","cookies","token","get","console","log","post","data","type","payload","checkAuth","Promise","all","then","useAuthUser","id"],"mappings":"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","sourcesContent":["import {useDispatch, useSelector} from \"react-redux\";\r\nimport {useEffect, useState} from \"react\";\r\nimport {Cookies} from \"react-cookie\";\r\nimport {fetchStart, fetchSuccess, setAUthToken} from \"../redux/actions\";\r\nimport jwtAxios from './Api'\r\nimport {SET_AUTH_USER_DATA, UPDATE_LOAD_USER} from \"../constants/ActionTypes\";\r\n\r\nexport const useAuthToken = () => {\r\n\tconst dispatch = useDispatch();\r\n\tconst [loading, setLoading] = useState(true);\r\n\tconst {user} = useSelector(({auth}) => auth);\r\n\r\n\tuseEffect(() => {\r\n\r\n\t\tconst validateAuth = async () => {\r\n\t\t\tdispatch(fetchStart());\r\n\t\t\tconst cookies = new Cookies();\r\n\t\t\tconst token = cookies.get(\"token\");\r\n\t\t\tconsole.log(\"token: =====>\", token)\r\n\t\t\tif (!token) {\r\n\t\t\t\tdispatch(fetchSuccess());\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdispatch(setAUthToken(token));\r\n\t\t\ttry {\r\n\t\t\t\tconst {data} = await jwtAxios.post(\"auth/me\");\r\n\t\t\t\tconsole.log(\"data: \", data)\r\n\t\t\t\tdispatch(fetchSuccess());\r\n\t\t\t\tdispatch({\r\n\t\t\t\t\ttype: SET_AUTH_USER_DATA,\r\n\t\t\t\t\tpayload: data.user\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.log(\"err in auth: \",err)\r\n\t\t\t\tdispatch(fetchSuccess());\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tconst checkAuth = () => {\r\n\t\t\tPromise.all([validateAuth()]).then(() => {\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t\tdispatch({type: UPDATE_LOAD_USER});\r\n\t\t\t});\r\n\t\t};\r\n\t\tcheckAuth();\r\n\t}, [dispatch]);\r\n\r\n\treturn [loading, user];\r\n};\r\n\r\nexport const useAuthUser = () => {\r\n\tconst {user} = useSelector(({auth}) => auth);\r\n\r\n\tif (user) {\r\n\t\treturn {id: 1, ...user};\r\n\t}\r\n\treturn [null];\r\n};\r\n"]},"metadata":{},"sourceType":"module"}